\documentclass{article}

\usepackage[style=alphabetic]{biblatex}
\addbibresource{paper.bib}

% https://ncatlab.org/nlab/show/Yoneda+embedding#ReferencesNotation
\usepackage[utf8]{inputenc}
\DeclareFontFamily{U}{min}{}
\DeclareFontShape{U}{min}{m}{n}{<-> udmj30}{}
\newcommand\yo{\!\text{\usefont{U}{min}{m}{n}\symbol{'207}}\!}

\usepackage{amsmath}
\usepackage{amssymb}
\usepackage{amsthm}
\usepackage{mathpartir}
\usepackage{tcolorbox}

\newtheorem{theorem}{Theorem}[section]
\newtheorem{lemma}[theorem]{Lemma}
\newtheorem{example}[theorem]{Example}

\newcommand*{\Prop}{\mathbf{Prop}}
\newcommand*{\Set}{\mathbf{Set}}
\newcommand*{\Ring}{\mathbf{Ring}}
\newcommand*{\CRing}{\mathbf{CRing}}
\newcommand*{\Graph}{\mathbf{Graph}}
\newcommand*{\Sh}{\mathrm{Sh}}
\newcommand*{\Psh}{\mathrm{Psh}}
\newcommand*{\B}{\mathbb{B}}
\newcommand*{\C}{\mathcal{C}}
\newcommand*{\N}{\mathbb{N}}
\newcommand*{\T}{\mathbb{T}}
\newcommand*{\Z}{\mathbb{Z}}
\newcommand*{\apart}{\mathrel{\#}}

% https://tex.stackexchange.com/a/223246
\newcommand*{\wand}{\mathbin{-\mkern-6mu*}}

\title{Instantiating Bunched Dependent Type Theory for Monoidal Classifying Toposes}
\author{finegeometer}

\begin{document}
\maketitle

\begin{abstract}
    In their PhD thesis, Sch\"opp introduces a type theory designed to capture the monoidal structure in the Schanuel topos.
    I provide a simple condition that can be used to verify whether the type theory interprets into a classifying topos of your choice.
\end{abstract}

\section{Intro}

\cite{schopp} introduces a bunched dependent type theory, \(\mathbf{BT}(*, 1, \Sigma, \Pi, \Pi^*)\),
of potentially general utility. But they only instantiate it for a single topos: the Schanuel topos.

By stitching together a few results from the literature,
I provide an easy method to verify that \(\mathbf{BT}(*, 1, \Sigma, \Pi, \Pi^*)\)
can be interpreted in a classifying topos of your choice,
so you can start \emph{using} the language as quickly as possible.

\section{Main Theorem}

\begin{theorem}
    Consider a geometric theory, \(\T\).
    For each pair \(A,B\) of sorts of \(\T\), let \((\sim) : A \times B \to \Prop\) be a relation, defined in terms of \(\T\)'s signature.
    Further suppose that \((\sim)\) is symmetric, and that the following holds.

    \begin{quote}
        Let \(X\) be an arbitrary sort of \(\T\), and let \(x : X\).
        Then if you restrict each sort \(A\) of \(\T\) to the subset \(\{a : A \mid a \sim x\}\),
        the result is another \(\T\)-model.
    \end{quote}

    \noindent Then \(\mathbf{BT}(*, 1, \Sigma, \Pi, \Pi^*)\) interprets into \(\Set[\T]\).
\end{theorem}

\subsection{Example}

As an example, let \(\T\) be the theory of local rings, and let \(\sim : R \times R \to \Prop\) be the relation \(a \sim b \iff a \cdot b = b \cdot a\).

\((\sim)\) is clearly symmetric. And for any \(x : R\), \(\{a : R \mid a \sim x\}\) is a local subring of \(R\).
So the conditions of the theorem are satisfied, and therefore the type theory interprets into \(\Set[\T]\).

\subsection{Details} \label{Details}

Some of the concepts in the theorem statement may be insufficiently precise. I address that here.

To say \(\sim\) is symmetric is to say that for every pair \(A,B\) of sorts in \(\T\),
the following is provable in the language of the theory.
\[a : A, b : B \vdash a \sim b \implies b \sim a\]

To say that the subsets \(\{a : A \mid a \sim x\}\) form another \(\T\)-model is to say the following:
\begin{itemize}
    \item For every sort \(X\) and every function symbol \(f : A_1 \times \dots \times A_n \to B\), the following is provable:
    \[x : X, a_1 : A_1 \dots a_n : A_n, a_1 \sim x \dots a_n \sim x \vdash f(a_1 \dots a_n) \sim x\]
    \item For every sort \(X\) and every axiom \(a_1 : A_1 \dots a_n : A_n, P \vdash Q\):
    
    Let \(P'\) be produced from \(P\)
    by replacing each existential quantifier \(\exists b : B, \dots\)
    with \(\exists b : B, b \sim x \land \dots\).
    Similarly define \(Q'\) in terms of \(Q\).
    Then the following is provable:
    \[x : X, a_1 : A_1 \dots a_n : A_n, a_1 \sim x \dots a_n \sim x, P' \vdash Q'\]
\end{itemize}

To see how this plays out in practice, consider the example from above --- the theory of local rings.

\begin{tcolorbox}[colback=red!5!white, colframe=red!50!black]
    \begin{mathpar}
        R \text{ sort}
        \and 0 : R
        \and 1 : R
        \\ (+) : R \times R \to R
        \and (\cdot) : R \times R \to R
        \and (-) : R \to R
        \\ a,b,c : R \vdash (a + b) + c = a + (b + c)
        \and a,b : R \vdash a + b = b + a
        \\ a : R \vdash a + 0 = a
        \and a : R \vdash a + (-a) = 0
        \\ a,b,c : R \vdash (a \cdot b) \cdot c = a \cdot (b \cdot c)
        \and a : R \vdash a \cdot 1 = a
        \\ a,b,c : R \vdash (a + b) \cdot c = a \cdot c + b \cdot c
        \and a,b,c : R \vdash a \cdot (b + c) = a \cdot b + a \cdot c
        \\ 0 = 1 \vdash \bot
        \and a,b : R, a + b = 1 \vdash
            (\exists c, a \cdot c = 1 \land c \cdot a = 1) \lor
            (\exists c, b \cdot c = 1 \land c \cdot b = 1)
    \end{mathpar}
    \tcblower
    \[a \sim b \iff a \cdot b = b \cdot a\]
\end{tcolorbox}

The sub-\(\T\)-model conditions say the following:
\begin{tcolorbox}[colback=blue!5!white, colframe=blue!50!black]
    \begin{align*}
        x : R &\vdash 0 x = x 0
        \\ x : R &\vdash 1 x = x 1
        \\ x,a,b : R, a x = x a, b x = x b &\vdash (a + b) x = x (a + b)
        \\ x,a,b : R, a x = x a, b x = x b &\vdash (a b) x = x (a b)
        \\ x,a : R, a x = x a &\vdash (-a) x = x (-a)
    \end{align*}
    \tcblower
    \begin{align*}
        x,a,b,c : R, ax=xa, bx=xb, cx=xc &\vdash (a + b) + c = a + (b + c)
        \\ x,a,b : R, ax=xa, bx=xb &\vdash a + b = b + a
        \\ x,a : R, ax=xa &\vdash a + 0 = a
        \\ x,a : R, ax=xa &\vdash a + (-a) = 0
        \\ x,a,b,c, ax=xa, bx=xb, cx=xc : R &\vdash (ab)c = a(bc)
        \\ x,a : R, ax=xa &\vdash a1 = a
        \\ x,a,b,c, ax=xa, bx=xb, cx=xc : R &\vdash (a + b) c = a c + b c
        \\ x,a,b,c, ax=xa, bx=xb, cx=xc : R &\vdash a (b + c) = a b + a c
        \\ x : R, 0 = 1 &\vdash \bot
        \\ x,a,b : R, ax=xa, bx=xb, a + b = 1 &\vdash \\
            (\exists c, cx=xc \land ac = 1 \land ca = 1) &\lor
            (\exists c, cx=xc \land bc = 1 \land cb = 1)        
    \end{align*}
\end{tcolorbox}

All of these are easily verified. More to the point, they capture the idea
that for all \(x : R\), the subset \(\{a : R \mid ax = xa\}\) is a local ring.

\section{Proof of Main Theorem}

To prove the main theorem, we begin by recalling a result from \cite{schopp}.

\begin{lemma}
    Let \(\B\) be a topos equipped with a strict affine symmetric monoidal closed structure \((*,\wand)\),
    such that \(- * A\) preserves pullbacks for all \(A\).
    Further suppose we have a canonical choice of pullback for every span in \(\B\).
    Then the type theory \(\mathbf{BT}(*, 1, \Sigma, \Pi, \Pi^*)\) interprets into \(\B\).
\end{lemma}

\begin{proof}
    Chapter 6 of \cite{schopp} shows that we can interpret the type theory in any ``\((*, 1, \Sigma, \Pi, \Pi^*)\)-type-category''.
    Section 3.5 tells us that \(\B\) is such a category.
\end{proof}

Next, we specialize to sheaf toposes.

\begin{lemma} \label{sh}
    Let \((C,J)\) be a (small) site, such that \(C\) is finitely complete,
    with a canonical choice of pullbacks.
    Let \(*\) be a strict affine symmetric monoidal structure on \(C\) that preserves pullbacks and covers.
    Then \(\Sh(C,J)\) satisfies the conditions of the above lemma.
\end{lemma}

\begin{proof}
    \(\Sh(C,J)\) is a Grothendieck topos, hence a topos. There is a canonical choice of pullbacks in \(\Sh(C,J)\), given by pointwise lifting the canonical pullbacks in \(C\).

    Now, theorem 4.3.2 from \cite{biering} shows the existence of a monidal structure \(\otimes^\Sh\) on \(\Sh(C,J)\),
    given by transporting Day convolution across the adjunction \((\mathbf{a} \dashv i) : \Psh(C,J) \rightleftarrows \Sh(C,J)\).
    Corollary 4.3.10 from the same shows that it is closed.
    Chasing definitions quickly shows \(\otimes^\Sh\) is symmetric.
    And the monoidal unit is the sheafification of the Yoneda embedding of \(*\)'s unit;
    since \(*\) is affine, this simplifies to the terminal object.

    In other words, \(\otimes^\Sh\) is an affine symmetric monoidal closed structure.
    It remains to show that this is strict --- that the canonical map \(A \otimes^\Sh B \to A \times B\) in \(\Sh(C,J)\) is always a monomorphism.

    We can reduce to the case of presheaves.
    Letting \(\otimes^\Psh\) represent Day convolution on \(\Psh(C)\),
    the map of interest is just the result of applying the sheafification functor, which preserves monomorphisms, to the canonical map \(iA \otimes^\Psh iB \to iA \times iB\).

    Expanding both \(\otimes^\Psh\) and \(\times\) as Day convolutions,
    this is a set-map, natural in \(c \in C^\mathrm{op}\), of the following type.
    \begin{scriptsize}\[\left(\int^{c_1,c_2 \in C} A(c_1) \times B(c_2) \times (c \xrightarrow{C} c_1 * c_2)\right) \to \left(\int^{c_1,c_2 \in C} A(c_1) \times B(c_2) \times (c \xrightarrow{C} c_1 \times c_2)\right)\]\end{scriptsize}
    This map is exactly what you'd expect it to be; it composes the \(c \xrightarrow{C} c_1 * c_2\) component
    with the canonical map \(c_1 * c_2 \xrightarrow{C} c_1 \times c_2\), and leaves everything else alone.
    Since that canonical map is mono, this is too.
\end{proof}

Finally, we set the site to a syntactic site, to understand classifying toposes.

\begin{lemma}
    Let \(\T\) be a geometric theory, satisfying the conditions of the main theorem.
    Then the syntactic site for \(\T\) satisfies the conditions of the above lemma.
\end{lemma}

\begin{proof}
    Let us define a few shorthands.

    We'll allow ourselves to write sequents involving compound types, such as \(p : A \times B \vdash \pi_1 p \sim \pi_2 p\).
    These can be straightforwardly ``compiled out'' to ordinary sequents, such as \(a : A, b : B \vdash a \sim b\).

    Next, if we have a context \(\Gamma = (a_1 : A_1, \dots, a_n : A_n, \phi_1 \dots \phi_p)\),
    we'll reuse the name \(\Gamma\) for the type \(\{(a_1, \dots, a_n) : A_1 \times \dots \times A_n \mid \phi_1 \land \dots \land \phi_p\}\).
    If we have a substitution \(f : \Gamma \to \Delta\) and a term \(\gamma : \Gamma\),
    there is a natural way to define the term \(f\gamma : \Delta\).

    Finally, if \(\gamma = (a_1, \dots, a_m) : \Gamma\) and \(\delta = (b_1, \dots, b_n) : \Delta\),
    we write \(\gamma \sim \delta\) as a shorthand for \(\bigwedge_{i=1}^m \bigwedge_{j=1}^n a_i \sim b_j\).

    With that out of the way, let's begin the proof.

    \vspace{1em}

    \noindent The syntactic category is guaranteed to be finitely complete, with a canonical construction for pullbacks.
    Specifically, the empty context is terminal,
    and the pullback of the span \(\Gamma \xrightarrow{f} \Xi \xleftarrow{g} \Delta\) is the context \((\gamma : \Gamma, \delta : \Delta, f\gamma = g\delta)\).

    Given contexts \(\Gamma\) and \(\Delta\), define \(\Gamma * \Delta = (\gamma : \Gamma, \delta : \Delta, \gamma \sim \delta)\).
    I claim this is a strict affine symmetric monoidal product on the syntactic category.
    \begin{itemize}
        \item Associativity and the unit laws are easily checked, and symmetry reduces to the symmetry of \(\sim\).
        \item Functoriality says that if \(f : \Gamma \to \Gamma'\), \(f \times \mathrm{id}_\Delta\) is a valid map \(\Gamma * \Delta \to \Gamma' * \Delta\).
        This reduces to the claim \(x : \Delta, \gamma : \Gamma, \gamma \sim x \vdash f\gamma \sim x\).
        Further reducing to the same claim about the basic sorts and function symbols, this is exactly one of the hypotheses, as detailed in Section \ref{Details}.
        \item Since \(\Gamma * \Delta\) is a subtype of \(\Gamma \times \Delta\), strictness holds, and the coherence equations are trivial.
    \end{itemize}

    It remains to show that for any context \(\Theta\), the functor \(- * \Theta\) preserves pullbacks and covers.

    Preservation of pullbacks is a direct computation. For the span \(\Gamma \xrightarrow{f} \Xi \xleftarrow{g} \Delta\),
    it simply says the following two contexts are isomorphic, a fact which is easily checked.
    \begin{align*}
        &(\gamma : \Gamma, \delta : \Delta, f\gamma = g\delta, \theta : \Theta, \gamma \sim \theta, \delta \sim \theta) \\
        &(\gamma : \Gamma, \theta_1 : \Theta, \gamma \sim \theta_1, \delta : \Delta, \theta_2 : \Theta, \delta \sim \theta_2, f\gamma = g\delta, \theta_1 = \theta_2)
    \end{align*}

    That leaves covers. Suppose \(\{f_i : \Gamma_i \to \Delta \mid i \in I\}\) is a cover,
    meaning \(\delta : \Delta \vdash \bigvee_{i \in I} \exists \gamma : \Gamma_i, f_i\gamma = \delta\) is \(\T\)-provable.

    We know by assumption that for any sort \(X\) and any \(x : X\),
    \(\T\)-provable statements remain \(\T\)-provable upon restricting each sort \(A\) to its subset \(\{a : A \mid a \sim x\}\).
    Iterating this fact, the same is true if we replace the sort \(X\) by a context, such as \(\Theta\).

    Therefore, we know the following statement is provable.
    \[\theta : \Theta, \delta : \{\delta : \Delta \mid \delta \sim \theta\} \vdash \bigvee_{i \in I} \exists \gamma : \{\gamma : \Gamma_i \mid \gamma \sim \theta\}, f_i\gamma = \delta\]

    But that's equivalent to the following.
    \[\delta : (\Delta * \Theta) \vdash \bigvee_{i \in I} \exists \gamma : (\Gamma_i * \Theta), (f_i * \mathrm{id}_\Theta)\gamma = \delta\]

    So \(\{f_i * \mathrm{id}_\Theta : \Gamma_i * \Theta \to \Delta * \Theta \mid i \in I\}\) is a cover, as required.
\end{proof}

Putting everything together:

\begin{proof}[Proof of Main Theorem]
    Combine the above four lemmas.
\end{proof}

\section{Using the Monoidal Structure}

For practical use, the main theorem isn't quite enough.
You'll need to know not just that \(*\)-types exist, but how they work.
If \(R\) is the generic local ring, you'll want to know that \(R * R = \{(a,b) : R^2 \mid ab = ba\}\).

Hence this next theorem.

\begin{theorem}
    Recall that \(\Set[\T]\) contains the generic model of \(\T\).
    Suppose \(A\) and \(B\) are sorts of \(\T\), interpreted in the generic model.
    Then, internally to the language, a pair \((a,b)\) is in the image of the inclusion \(A * B \hookrightarrow A \times B\) exactly when \(a \sim b\).
\end{theorem}

\begin{proof}
    To avoid confusion, write \(A\) to refer to the sort in \(\T\),
    \((a:A)\) to refer to the \emph{context} in \(\T\),
    and \(U_A\) to refer to the corresponding type in the generic model.

    Then \(U_A\) interprets as \(\mathbf{a}\yo(a:A)\), and similarly for \(B\).
    The type \(\{(a,b) : U_A \times U_B \mid a \sim b\}\) interprets as \(\mathbf{a}\yo(a:A, b:B, a \sim b)\),
    and its inclusion into \(U_A \times U_B\) is \(\mathbf{a} \circ \yo\) applied to the obvious substitution \((a:A,b:B,a \sim b) \to (a:A,b:B)\).

    Now, in the proof of Lemma \ref{sh}, we computed the interpretation of a general inclusion \(X * Y \hookrightarrow X \times Y\).
    Specializing to the types \(U_A\) and \(U_B\), that result simplifies to the obvious map
    \(\mathbf{a}\yo((a:A) * (b:B)) \to \mathbf{a}\yo((a:A) \times (b:B))\).
    That is, it's \(\mathbf{a} \circ \yo\) applied to the obvious substitution from \((a:A,b:B,a \sim b)\) to \((a:A,b:B)\).

    So the interpretations match. Thus \(U_A * U_B = \{(a,b) : U_A \times U_B \mid a \sim b\}\), as subsets of \(U_A \times U_B\).
\end{proof}

\section{Future Work}

The purpose of this paper is to \emph{enable} future work.
Namely, the exploration of monoidal toposes via their internal languages.

But beyond that, there are a few other directions to pursue.

First, \cite{blechschmidt} provides a powerful reasoning principle for the generic model of an arbitrary theory.
It would be useful to either generalize or leverage this to prove facts involving the monoidal structure.
For instance, calculations in the interpretation sugggest that the generic local ring should support
the isomorphism \((\{x : R | x^2 = 0\} \wand R) \simeq R^2\),
analogous to the Kock-Lawvere axiom \((\{x : R | x^2 = 0\} \to R) \simeq R^2\)
supported by the generic \emph{commutative} local ring.
The commutative case follows immediately from \cite[Theorem 4.10]{blechschmidt};
is there a similarly slick way to derive the noncommutative version?

Second, it would be worthwhile to extend this result to other type theories.
For instance, \cite{schopp} defines the type theory
\(\mathbf{BT}(*, 1, \Sigma, \Pi, \Pi^*, B^{*(M:A)}, \Sigma^*)\),
which provides monoidal sigma types as well as pi types.
Furthermore, it appears that \cite{schopp}'s type theories are not the end of the story,
based both on their comments in section 13 and the existence of many competing approaches in the literature.
As new and better type theories are designed, it will be valuable to have a quick way to know when they apply.

\printbibliography

\end{document}