\documentclass{article}

\usepackage[style=alphabetic]{biblatex}
\addbibresource{paper.bib}

% https://ncatlab.org/nlab/show/Yoneda+embedding#ReferencesNotation
\usepackage[utf8]{inputenc}
\DeclareFontFamily{U}{min}{}
\DeclareFontShape{U}{min}{m}{n}{<-> udmj30}{}
\newcommand\yo{\!\text{\usefont{U}{min}{m}{n}\symbol{'207}}\!}

\usepackage{amsmath}
\usepackage{amssymb}
\usepackage{amsthm}
\usepackage{mathpartir}

\newtheorem{theorem}{Theorem}[section]
\newtheorem{lemma}[theorem]{Lemma}
\newtheorem{construction}[theorem]{Construction}
\newtheorem{example}[theorem]{Example}

\newcommand*{\Prop}{\mathbf{Prop}}
\newcommand*{\Set}{\mathbf{Set}}
\newcommand*{\Ring}{\mathbf{Ring}}
\newcommand*{\CRing}{\mathbf{CRing}}
\newcommand*{\Graph}{\mathbf{Graph}}
\newcommand*{\Sh}{\mathrm{Sh}}
\newcommand*{\Psh}{\mathrm{Psh}}
\newcommand*{\B}{\mathbb{B}}
\newcommand*{\C}{\mathcal{C}}
\newcommand*{\N}{\mathbb{N}}
\newcommand*{\T}{\mathbb{T}}
\newcommand*{\Z}{\mathbb{Z}}
\newcommand*{\apart}{\mathrel{\#}}

% https://tex.stackexchange.com/a/223246
\newcommand*{\wand}{\mathbin{-\mkern-6mu*}}

\title{Instantiating Bunched Dependent Type Theory for Monoidal Classifying Toposes}
\author{finegeometer}

\begin{document}
\maketitle

\begin{abstract}
    In their PhD thesis, Sch\"opp introduces a type theory designed to capture the monoidal structure in the Schanuel topos.
    I provide a simple condition that can be used to verify whether the type theory interprets into a classifying topos of your choice.
\end{abstract}

\section{Intro}

Dependent type theory, in its standard form, has a model in every topos.
By working within the type theory, you can therefore reason ``internally'' to the topos.

To capture an additional monoidal structure on the topos,
\cite{schopp} extends the type theory to a system they call \(\mathbf{BT}(*, 1, \Sigma, \Pi, \Pi^*)\).
While that paper is specific to the Schanuel topos, the type theory described within is applicable to many others.

I provide an easy method to verify that \(\mathbf{BT}(*, 1, \Sigma, \Pi, \Pi^*)\)
can be interpreted in a classifying topos of your choice,
so you can start \emph{using} the internal language as quickly as possible.

\section{Main Theorem}

For simplicity of exposition, I describe the theorem and proof in the case of single-sorted theories.
The extension to multiple sorts is straightforward, but terminologically awkward.

\begin{theorem}
    Let \(\T\) be a single-sorted geometric theory, with sort \(X\).
    Let \((\sim) : X \to X \to \Prop\) be a geometrically-defined symmetric relation.
    Further suppose that for any \(x \in X\), \(\{a : X \mid a \sim x\}\) is a sub-\(\T\)-model of \(X\).
    Then \(\mathbf{BT}(*, 1, \Sigma, \Pi, \Pi^*)\) interprets into \(\Set[\T]\).
\end{theorem}

For example, let \(\T\) be the theory of rings, and let \(a \sim b\) mean \(ab = ba\).
The hypothesis holds because centralizers of rings are rings;
so we get an interpretation of the bunched type theory into \(\Set[\Ring]\).

\subsection{Details} \label{Details}

The above makes more sense intuitively than formally.
So to be perfectly precise, when I say
``\(\{a : X \mid a \sim x\}\) is a sub-\(\T\)-model of \(X\)'',
I mean the following:
\begin{itemize}
    \item For every function symbol \(f : X^n \to X\), we require:
    \[x : X, \substack{a_1 : X \\ a_1 \sim x}, \dots, \substack{a_n : X \\ a_n \sim x} \vdash f(a_1 \dots a_n) \sim x\]
    \item For every axiom of \(\T\), run the following steps. We require the resulting sequent to hold.
    \begin{itemize}
        \item Prepend a variable \(x : X\) to the context.
        \item For each other variable \(a : X\) in the context, add an additional hypothesis \(a \sim x\).
        \item Replace every instance of \(\exists a : X, P\) with \(\exists a : X, a \sim x \land P\).
    \end{itemize}
\end{itemize}

As an example of the latter, say \(\T\) is the theory of inhabited sets, with axiom \(\vdash \exists a : X, \top\).
Then the required sequent is \(x : X \vdash \exists a : X, a \sim x \land \top\).

\section{Proof of Main Theorem}

For the duration of this section, we accept the assumptions of the main theorem.

\vspace{1em}

\noindent To begin, notice a key detail of the transformation described above.
\begin{lemma} \label{transform-lemma}
    The transformation of sequents described in section \ref{Details},
    used there to transform the axioms of \(\T\), preserves derivability.
    Any provable sequent remains provable after the transformation.
\end{lemma}

\begin{proof}
    First, prove that for any term \(t\) in any context, \(t \sim x\) is provable in the transformed context.
    This is immediate by induction on the structure of \(t\) ---
    for variables, the transformation added \(t \sim x\) to the context;
    for compound terms, \(f(t_1 \dots t_n) \sim x\) follows from the statements \(t_i \sim x\).

    Now the lemma follows from a second induction, this time on the structure of proofs.
    There are a number of cases; all of them easy, so I'll provide just two examples.
    
    Consider the introduction and elimination rules for \(\exists\).
    \begin{mathpar}
        \inferrule{\Gamma \vdash t : X \\ \Gamma \vdash P[t/a]}{\Gamma \vdash \exists a:X, P}
        \and \inferrule{\Gamma \vdash \exists a:X, P \\ \Gamma, a:X, P \vdash Q}{\Gamma \vdash Q}
    \end{mathpar}
    After transformation, these become:
    \begin{mathpar}
        \inferrule{\Gamma' \vdash t : X \\ \Gamma' \vdash P'[t/a]}{\Gamma' \vdash \exists a:X, a \sim x \land P'}
        \and \inferrule{\Gamma' \vdash \exists a:X, a \sim x \land P' \\ \Gamma', a:X, a \sim x, P' \vdash Q'}{\Gamma' \vdash Q'}
    \end{mathpar}
    Both of which are immediate; the first because we've already proven \(\Gamma' \vdash t \sim x\).
\end{proof}

Next, bootstrap to the syntactic site.
\begin{construction}
    We place a monoidal structure on \(\T\)'s syntactic category.
\end{construction}

\begin{proof}
    Given two contexts \(A\) and \(B\), define their product by extending \(A \times B\) with the hypotheses \(a \sim b\) for each variable \(a\) in the first context and each variable \(b\) in the second.
    For example:
    \[(a,b : X, \phi(a,b)) * (c : X, \psi(c)) = (a,b,c : X, \phi(a,b), \psi(c), a \sim c, b \sim c)\]
    
    We'll handle functoriality one argument at a time.

    Given a morphism \(f : A \to A'\), we must produce a morphism \(f*1_B : A*B \to A'*B\).
    That is, a provably functional relation on the combined context \((A*B) \times (A'*B)\).

    But \(f \times 1_B : A \times B \to A' \times B\) is similarly a relation on the context \((A \times B) \times (A' \times B)\).
    We choose its restriction.

    Is this restriction provably functional? The only potential point of failure is the existence of an output value. So we must show:
    \[(\vec{a},\vec{b}) : (A*B) \vdash \exists (\vec{a'},\vec{b'}) : (A'*B), (f*1_B)((\vec{a},\vec{b}), (\vec{a'},\vec{b'}))\]

    Or equivalently:
    \[\vec{a} : A, \vec{b} : B, \vec{a} \sim \vec{b} \vdash \exists \vec{a'} : A', \exists \vec{b'} : B, \vec{a'} \sim \vec{b'} \land f(\vec{a},\vec{a'}) \land \vec{b} = \vec{b'}\]
    \[\vec{a} : A, \vec{b} : B, \vec{a} \sim \vec{b} \vdash \exists \vec{a'} : A', \vec{a'} \sim \vec{b} \land f(\vec{a},\vec{a'})\]

    But this is obtained from \(\vec{a} : A \vdash \exists \vec{a'} : A', f(\vec{a},\vec{a'})\) by applying Lemma \ref{transform-lemma} once for each variable in \(B\).
    And that holds because \(f\) is provably functional.

    \vspace{1em}

    We've defined \(f * 1_B\). The definition of \(1_A * g\) is analogous.
    All of the functoriality laws, including the interchange condition \((f * 1) \circ (1 * g) = (1 * g) \circ (f * 1)\),
    follow from relating \(f * 1_B\) back to \(f \times 1_B\), and using the bifunctoriality of the cartesian product.
\end{proof}

\begin{lemma}\leavevmode
    \begin{enumerate}
        \item The monoidal structure is symmetric, with the terminal object as the monoidal unit.
        \item The canonical map \(A*B \to A \times B\) is a monomorphism.
        \item For any \(X\), the endofunctor \(-*X\) preserves pullbacks and covers.
    \end{enumerate}
\end{lemma}

\begin{proof}\leavevmode
    \begin{enumerate}
        \item Immediate by chasing definitions.
        \item \(A*B\) is simply \(A \times B\) with extra hypotheses.
        \item \begin{description}
            \item[Pullbacks:] Consider any cospan \(A \xrightarrow{f} C \xleftarrow{g} B\). We have:
            \begin{align*}
                A \times_C B &= \vec{a} : A, \vec{b} : B, \vec{c} : C, f(a,c), g(b,c)
                \\ (A \times_C B) * X &= \vec{a} : A, \vec{b} : B, \vec{c} : C, f(a,c), g(b,c),
                \\ &\qquad \vec{x} : X, \vec{a} \sim \vec{x}, \vec{b} \sim \vec{x}, \vec{c} \sim \vec{x}
                \\ (A*X) \times_{C*X} (B*X) &= \vec{a} : (A*X), \vec{b} : (B*X), \vec{c} : (C*X),
                \\ &\qquad (f*1_X)(a,c), (g*1_X)(b,c)
                \\ &= \vec{a} : A, \vec{x}_1 : X, \vec{a} \sim \vec{x}_1,
                \\ &\qquad \vec{b} : A, \vec{x}_2 : X, \vec{b} \sim \vec{x}_2,
                \\ &\qquad \vec{c} : A, \vec{x}_3 : X, \vec{c} \sim \vec{x}_3,
                \\ &\qquad f(a,c), \vec{x}_1 = \vec{x}_3,
                \\ &\qquad g(b,c), \vec{x}_2 = \vec{x}_3
            \end{align*}
            \item[Covers:] Consider any cover \(\{f_i : A_i \to B | i \in I\}\).
            Since this is a cover:
            \[\vec{b} : B \vdash \bigvee_{i \in I} \exists \vec{a} : A_i, f_i(\vec{a},\vec{b})\]
            We are to show that \(\{f_i*1_X : A_i*X \to B*X | i \in I\}\) is a cover. That is:
            \[\vec{b} : B*X \vdash \bigvee_{i \in I} \exists \vec{a} : A_i*X, (f_i*1_X)(\vec{a},\vec{b})\]
            Equivalently:
            \[\vec{b} : B, \vec{x} : X, \vec{b} \sim \vec{x} \vdash \bigvee_{i \in I} \exists \vec{a} : A_i, \exists \vec{y} : X, \vec{a} \sim \vec{y} \land f_i(\vec{a},\vec{b}) \land \vec{y} = \vec{x}\]
            \[\vec{b} : B, \vec{x} : X, \vec{b} \sim \vec{x} \vdash \bigvee_{i \in I} \exists \vec{a} : A_i, \vec{a} \sim \vec{x} \land f_i(\vec{a},\vec{b})\]
            But this follows from applying the transformation in Lemma \ref{transform-lemma} to the hypothesis, once for each variable in \(X\).
        \end{description}
    \end{enumerate}
\end{proof}

Lift to the classifying topos.

\begin{construction} \label{sh}
    We equip \(\Set[\T]\) with a strictly affine symmetric monoidal closed structure \((*,\wand)\).
\end{construction}

\begin{proof}
    Let \(\C_\T\) be \(\T's\) syntactic category. Recall that \(\Set[\T] = \Sh(\C_\T)\).

    Theorem 4.3.2 from \cite{biering} defines a monidal structure \(\otimes^\Sh\) on \(\Sh(\C_\T)\),
    given by transporting Day convolution across the adjunction \((\mathbf{a} \dashv i) : \Psh(\C_\T) \rightleftarrows \Sh(\C_\T)\).
    Corollary 4.3.10 from the same shows that it is closed.

    The monoidal unit is the sheafification of the Yoneda embedding of \(*\)'s unit.
    Since \(*\) is affine, this simplifies to the terminal object.

    Symmetry is a simple definition chase. So it remains only to show that
    that the canonical map \(A \otimes^\Sh B \to A \times B\) in \(\Sh(C,J)\) is always a monomorphism.

    Letting \(\otimes^\Psh\) represent Day convolution on \(\Psh(C)\),
    the map of interest is just the result of applying the sheafification functor,
    which preserves monomorphisms, to the canonical map \(iA \otimes^\Psh iB \to iA \times iB\).

    Expanding both \(\otimes^\Psh\) and \(\times\) as Day convolutions,
    this is a \(\Set\)-map, natural in \(c \in C^\mathrm{op}\), of the following type.
    \begin{scriptsize}\[\left(\int^{c_1,c_2 \in C} A(c_1) \times B(c_2) \times (c \xrightarrow{C} c_1 * c_2)\right) \to \left(\int^{c_1,c_2 \in C} A(c_1) \times B(c_2) \times (c \xrightarrow{C} c_1 \times c_2)\right)\]\end{scriptsize}
    This map is exactly what you'd expect it to be; it composes the \(c \xrightarrow{C} c_1 * c_2\) component
    with the canonical map \(c_1 * c_2 \xrightarrow{C} c_1 \times c_2\), and leaves everything else alone.
    Since that canonical map is mono, this is too.
\end{proof}

And finally:

\begin{construction}
    We have an interpretation of \(\Set[\T]\) into \(\mathbf{BT}(*, 1, \Sigma, \Pi, \Pi^*)\).
\end{construction}

\begin{proof}
    Apply section 3.5 of \cite{schopp} to see that \(\Set[\T]\) is a ``\((*, 1, \Sigma, \Pi, \Pi^*)\)-type-category'',
    then apply Chapter 6 of the same to construct the interpretation.
\end{proof}

\section{Using the Monoidal Structure}

For practical use, the main theorem isn't quite enough.
You'll need to know not just that \(*\)-types exist, but how they work.
If \(R\) is the generic local ring, you'll want to know that \(R * R = \{(a,b) : R^2 \mid ab = ba\}\).

Hence this next theorem.

\begin{theorem}
    Let \(U\) be the generic \(\T\)-model in \(\Set[\T]\).
    Then \(U * U = \{(a,b) : U \times U \mid a \sim b\}\), as subsets of \(U \times U\).
\end{theorem}

\begin{proof}
    Viewing \(\Set[\T]\) as \(\Sh(\C_\T)\), expand.
    \begin{align*}
        U \otimes^\Sh U
        &\simeq \mathbf{a}\yo(x:X) \otimes^\Sh \mathbf{a}\yo(x:X)
        \\ &\simeq \mathbf{a}(i\mathbf{a}\yo(x:X) \otimes^\Psh i\mathbf{a}\yo(x:X))
        \\ &\simeq \mathbf{a}(\yo(x:X) \otimes^\Psh \yo(x:X))
        \\ &\simeq \mathbf{a}\yo((x:X) * (x:X))
        \\ &\simeq \mathbf{a}\yo(a:X, b:X, a \sim b)
        \\ &\simeq \{(a,b) : U \times U \mid a \sim b\}
    \end{align*}

    Tracing the first projection \(1_U \otimes^\Sh ! : U \otimes^\Sh U \to U \otimes^\Sh \mathbf{1}\)
    through the chain of isomorphisms, we see that it becomes the map \((a,b) \mapsto a\)
    from \(\{(a,b) : U \times U \mid a \sim b\}\) to \(U\).
    Similarly for the second projection.
    The canonical map \(U \otimes^\Sh U \to U \times U\) is the product of these,
    so it becomes the inclusion \(\{(a,b) : U \times U \mid a \sim b\} \hookrightarrow U \times U\),
    as required.
\end{proof}

\section{Future Work}

The purpose of this paper is to \emph{enable} future work.
Namely, the exploration of monoidal toposes via their internal languages.

But beyond that, there are a few other directions to pursue.

First, \cite{blechschmidt} provides a powerful reasoning principle for the generic model of an arbitrary theory.
It would be useful to either generalize or leverage this to prove facts involving the monoidal structure.
For instance, calculations in the interpretation sugggest that the generic local ring should support
the isomorphism \((\{x : R | x^2 = 0\} \wand R) \simeq R^2\),
analogous to the Kock-Lawvere axiom \((\{x : R | x^2 = 0\} \to R) \simeq R^2\)
supported by the generic \emph{commutative} local ring.
The commutative case follows immediately from \cite[Theorem 4.10]{blechschmidt};
is there a similarly slick way to derive the noncommutative version?

Second, it would be worthwhile to extend this result to other type theories.
For instance, \cite{schopp} defines the type theory
\(\mathbf{BT}(*, 1, \Sigma, \Pi, \Pi^*, B^{*(M:A)}, \Sigma^*)\),
which provides monoidal sigma types as well as pi types.
Furthermore, it appears that \cite{schopp}'s type theories are not the end of the story,
based both on their comments in section 13 and the existence of many competing approaches in the literature.
As new and better type theories are designed, it will be valuable to have a quick way to know when they apply.

\printbibliography

\end{document}